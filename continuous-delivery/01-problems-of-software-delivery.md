# 软件交付的问题

## 引言

本书的核心模式是`部署流水线`，以`持续集成`理论作为其理论基石

部署流水线有三个目标
* 让软件构建，部署，测试和发布过程对所有人可见，促进合作
* 改善反馈，能在整个过程中更早的发现和解决问题（做一件事，有问题发生是一定的，重要的是快速的定位和解决问题）
* 使在任何环境下部署和发布任意版本的应用成为自动化得过程

一个简单的简单的`部署流水线`

提交阶段 ==> 自动化验收测试 ==> 自动化容量测试 ==> 手工测试 ==> 发布

## 一些常见的反模式

### 手工部署软件

这个反模式一般具有如下特征

* 有一份详尽的操作文档，其中描述了多出需要注意的地反
* 手工测试程序是否运行正确
* 总有客户来问，部署怎么又出问题了
* 如果是集群环境，个环境配置经常有出入
* 发布过程时间较长
* 发布结果无法预测（凭运气）
* 经常加班，还搞不定问题

理想的部署流程应该是

1. 挑选要部署的版本和环境
2. 按一下“部署”按钮

为什么需要部署自动化

* 使部署过程可重复
* 免去部署文档的维护，一个部署脚本即是所有文档
* 部署过程可审计追踪
* 摆脱对人的过分依赖

### 开发完成之后才向生产环境部署

经常出现的情况

* 运维人员之前一直没有接触过应用程序
* 程序相关的配置，数据库脚本，部署文档等都没有在正式环境下测试过
* 开发团队和运维团队协作太少

导致的各种问题

* 第一次部署成了噩梦
* 开发环境和部署环境差距越大，问题越多
* 各团队之间协作焦头烂额

解决方案

将测试，部署和发布活动都纳入到开发过程中，让他们成为正常开发流程的一部分，对部署过程也进行测试

### 生产环境的手工配置

这种反模式经常有如下特征

* 诶，我本地好使啊
* 集群中各节点表现不同
* 每次准备环境事件长
* 无法回滚
* 不知不觉，集群中的服务器，操作系统配置变得都不一样了

怎样解决这些问题？

采用配置管理，可以重复的创建开发应用程序所需要的每个基础设施

对于各个环境中的信息，都应该完全掌控，而且，所有环境的生成，配置的修改都应该由自动化程序实现，禁止手动修改

### 如何改变这种情况

采用部署流水线，将软件的发布变成一种低风险、频繁、廉价、迅速且可预见的过程

最后的目标是实现将自动化的测试和部署，以及全面的配置管理结合在一起，实现一键式软件发布

## 如何实现目标

为保证能持续的以高质量交付我们的软件，需要**频繁的自动化发布软件**

对于频繁的自动化发布软件，**反馈**是至关重要的，对于反馈，应该达到三个标准

### 无论什么样的修改都应该触发反馈流程

这些修改包括对以下项的修改

1. 源代码（[持续集成]())
2. 配置信息([配置管理]())
3. 运行环境([基础设施和环境管理]())
4. 数据([数据管理]())

#### 反馈流程

完全自动化的方式尽可能的测试每一次变更

测试内容包括但不限于

* 创建可执行代码的流程必须是能奏效的。这用于验证源代码是否符合语法
* 软件的单元测试必须是成功的。这可以检查应用程序的行为是否与期望相同
* 软件应该满足一定的质量标准，比如测试覆盖率以及其他与技术相关的度量项
* 软件的功能验收测试必须是成功的。这可以检查应用是否满足业务验收条件，交付了所期望的业务价值
* 软件的非功能测试必须是成功的。这可以检查应用程序是否满足用户对性能、有效性、安全性等方面的要求
* 软件必须通过了探索性测试，并给客户以及部分用户做过演示。这些通常在一个手工测试环境上完成。此时，产品负责人可能认为软件功能还有缺失，我们自己也可能发现需要修复的缺陷，还要为其写自动化测试来避免回归测试

### 反馈应该尽快发出



### 交付团队必须接收反馈，并依据它做出行动响应
